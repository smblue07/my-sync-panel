# پنل پیشرفته مدیریت کاربران و همگام‌سازی ترافیک برای 3x-ui

این پروژه یک پنل وب مستقل و پیشرفته است که قابلیت‌های مدیریتی قدرتمندی را به پنل 3x-ui اضافه می‌کند. این ابزار به مدیران سرور اجازه می‌دهد تا به صورت متمرکز و از طریق یک رابط کاربری گرافیکی، کاربران و گروه‌های کاربری را مدیریت کرده، ترافیک آن‌ها را همگام‌سازی کنند و کاربران جدیدی را به سادگی به چندین اینباند به صورت همزمان اضافه نمایند.


## قابلیت‌های کلیدی

- **رابط کاربری تحت وب:** یک پنل مدیریتی کامل با دو منوی مجزا برای "مدیریت همگام‌سازی" و "افزودن کاربر".
- **سیستم ورود امن:** هماهنگ با نام کاربری و رمز عبور اصلی پنل 3x-ui شما.
- **ساخت کاربر پیشرفته:**
    - قابلیت ساخت یک کاربر جدید و افزودن آن به **چندین اینباند** به صورت همزمان.
    - ساخت خودکار شناسه‌های کاربری منحصربه‌فرد برای هر اینباند (مثلاً `user-1`, `user-2`).
    - تعیین حجم کل (Total) و تاریخ انقضا (Expiry) برای کاربر جدید.
- **مدیریت جامع گروه‌ها (بر اساس `subId`):**
    - نمایش کامل اطلاعات هر گروه شامل لیست اعضا، حجم مصرفی و حجم کل هر کاربر.
    - نمایش مجموع حجم کل و تاریخ انقضای مرجع برای هر گروه.
- **همگام‌سازی هوشمند ترافیک:**
    - همگام‌سازی افزایشی و هوشمند حجم مصرفی کاربران یک گروه با استفاده از فایل وضعیت (State File).
    - قابلیت انتخاب گروه‌ها برای همگام‌سازی از طریق **"لیست سفید" (Whitelist)**.
- **کنترل دستی کامل:**
    - دکمه "همگام‌سازی دستی" با نمایش زنده لاگ عملیات در همان صفحه.
    - فرم ویرایش قدرتمند برای هر گروه جهت تنظیم دستی **مصرف فعلی**، **حجم کل** و **تاریخ انقضا** برای تمام اعضای گروه به صورت یکجا.

---

## پیش‌نیازها

1.  یک سرور لینوکس (تست شده روی Ubuntu/Debian).
2.  پنل 3x-ui باید از قبل نصب و در حال اجرا باشد.
3.  ساختار دیتابیس پنل 3x-ui باید شامل جدول `client_traffics` و ستون `settings` در جدول `inbounds` باشد.

---

## نصب و راه‌اندازی

برای نصب کامل این پنل مدیریتی روی یک سرور جدید، کافیست دستور زیر را اجرا کنید. اسکریپت به صورت هوشمند شماره پورت مورد نظر شما را پرسیده و تمام مراحل را به صورت خودکار انجام می‌دهد.

```bash
wget -O install.sh [https://raw.githubusercontent.com/smblue07/my-sync-panel/main/install.sh](https://raw.githubusercontent.com/smblue07/my-sync-panel/main/install.sh) && chmod +x install.sh && ./install.sh
```
**توجه:** آدرس بالا را با آدرس `install.sh` در ریپازیتوری گیت‌هاب خودتان جایگزین کنید.

پس از نصب، می‌توانید از طریق آدرس `http://<YOUR_SERVER_IP>:<PORT>` به پنل دسترسی پیدا کنید.

---

## پیکربندی و مدیریت

- **اسکریپت اصلی همگام‌سازی:** `/root/the_final_sync.py`
    - این اسکریپت توسط `cronjob` به صورت خودکار اجرا می‌شود. برای اجرای دستی می‌توانید از دستور `python3 /root/the_final_sync.py` استفاده کنید.
- **لیست سفید:** `/root/sync_whitelist.txt`
    - نام `subId` گروه‌هایی که می‌خواهید همگام‌سازی شوند را در این فایل وارد کنید (هر کدام در یک خط).
- **فایل وضعیت (حافظه):** `/root/sync_state.json`
    - این فایل وضعیت آخرین همگام‌سازی را ذخیره می‌کند. برای ریست کردن کامل محاسبات، کافیست این فایل را حذف کنید.
- **سرویس پنل وب:**
    - برای بررسی وضعیت سرویس: `systemctl status sync_manager`
    - برای ری‌استارت کردن سرویس: `systemctl restart sync_manager`

---

## تکنولوژی‌های استفاده شده

- **Backend:** Python, Flask
- **Frontend:** HTML, CSS
- **Database Interaction:** SQLite
- **Automation:** Bash Scripting, systemd, cron
